<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta name="google-site-verification" content="5rHjz-eGZ-TyGu184pR_2oTXrTNV5p2B54i9_4yAGDU" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Pylith," />





  <link rel="alternate" href="/atom.xml" title="CollyKing's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Pylith is a command-line software for finite element model calculation, but it does not include the creation of the mesh model. It needs other softwares such as Lagrit, Trelis&#x2F;Cubit, etc to create com">
<meta property="og:type" content="article">
<meta property="og:title" content="「Pylith」Simple tutorial (II) Model set up">
<meta property="og:url" content="https://collyking.top/2020/24164.html">
<meta property="og:site_name" content="CollyKing&#39;s Blog">
<meta property="og:description" content="Pylith is a command-line software for finite element model calculation, but it does not include the creation of the mesh model. It needs other softwares such as Lagrit, Trelis&#x2F;Cubit, etc to create com">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2018/12/27/5c24e0c435e4c.png">
<meta property="og:image" content="https://i.loli.net/2019/07/13/5d29e05e1e5af88039.png
">
<meta property="og:image" content="https://i.loli.net/2019/07/13/5d29e05e372ac60989.png
">
<meta property="og:image" content="https://i.loli.net/2019/07/13/5d29e05e528a974620.png
">
<meta property="og:image" content="https://i.loli.net/2019/07/13/5d29e05e65e8c71640.png
">
<meta property="og:image" content="https://i.loli.net/2019/07/13/5d29e05e51fae26755.png
">
<meta property="article:published_time" content="2020-01-10T07:31:38.000Z">
<meta property="article:modified_time" content="2020-01-10T07:58:23.000Z">
<meta property="article:author" content="collyking">
<meta property="article:tag" content="Pylith">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2018/12/27/5c24e0c435e4c.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://collyking.top/2020/24164.html"/>





  <title>「Pylith」Simple tutorial (II) Model set up | CollyKing's Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-120906176-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?71aaf6e0dcc6e1ca17166f8ea1d8d1c9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CollyKing's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Stay hungry, stay foolish</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://collyking.top/2020/24164.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2017/08/24/599ea0e05f155.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CollyKing's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">「Pylith」Simple tutorial (II) Model set up</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-10T15:31:38+08:00">
                2020-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Pylith/" itemprop="url" rel="index">
                    <span itemprop="name">Pylith</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/24164.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2020/24164.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/24164.html" class="leancloud_visitors" data-flag-title="「Pylith」Simple tutorial (II) Model set up">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          
              <div class="post-description">
                  Pylith is a command-line software for finite element model calculation, but it does not include the creation of the mesh model. It needs other softwares such as Lagrit, Trelis/Cubit, etc to create compatible mesh files. This manual will tell you how to build a simple mesh model using Trelis in the basic of Pylith example/3d/Tet4.
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="1-Trelis-interface"><a href="#1-Trelis-interface" class="headerlink" title="1.Trelis interface"></a>1.Trelis interface</h2><p>The Trelis software interface is shown below.</p>
<p><img src="https://i.loli.net/2018/12/27/5c24e0c435e4c.png" alt="00"></p>
<p>Panels that are frequently used::</p>
<ol>
<li>Command Panel: For quick geometry creation, segmentation, combination and mesh division</li>
<li>Command Line: Complete the same function as command panel but by the way of the command lines.</li>
<li>Tool bar: The first five lines are create, open, save, import and export files. The middle part includes running the journal script file and adjusting the observation mode.</li>
<li>Model Tree: Each part of the model is displayed at the level of body-volume-surface-curve-vertex. And each element has a corresponding ID number for designation.<br>More details can be found in <a target="_blank" rel="noopener" href="https://www.csimsoft.com/download?file=Documents/TrelisGettingStarted.pdf">Official Guide</a>. Note that each step of Trelis has a corresponding script command, which is convenient for saving and sharing.</li>
</ol>
<h2 id="2-Create-Geometry"><a href="#2-Create-Geometry" class="headerlink" title="2.Create Geometry"></a>2.Create Geometry</h2><h3 id="2-1-Create-a-volume"><a href="#2-1-Create-a-volume" class="headerlink" title="2.1. Create a volume"></a>2.1. Create a volume</h3><p>First create a 600km x 600km x 400km volume. Since the default origin is in the center of the new volume, we will move the volume down by 200km. Thus the upside surface represents the surface.<br>The following script can be copied and pasted directly to the command line.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Like shell script,Trelis uses &#x27;#&#x27; for comments# ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create block</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Block is 600 km x 600 km x 400 km</span></span><br><span class="line"><span class="comment"># -300 km &lt;= x &lt;= 300 km</span></span><br><span class="line"><span class="comment"># -300 km &lt;= y &lt;= 300 km</span></span><br><span class="line"><span class="comment"># -400 km &lt;= z &lt;= 0 km</span></span><br><span class="line">reset</span><br><span class="line">brick x <span class="number">600000</span> y <span class="number">600000</span> z <span class="number">400000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Translate block so the top is at z=0</span></span><br><span class="line">volume <span class="number">1</span> move x <span class="number">0</span> y <span class="number">0</span> z -<span class="number">200000</span></span><br></pre></td></tr></table></figure>
<p>In addition to the above method, Trelis can also create a volume by:</p>
<blockquote>
<p>creating vertexes–&gt; creating surfaces by specified vertex–&gt;create a volume by specify surfaces<br>Although it is more cumbersome, an example also shows here for reference.</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Set units to SI.</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">$&#123;Units(<span class="string">&#x27;si&#x27;</span>)&#125;</span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create vertex</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># A cuboid has 8 corner points</span></span><br><span class="line">reset</span><br><span class="line">create vertex  &#123; <span class="number">300</span>*km&#125;  &#123; <span class="number">300</span>*km&#125; &#123;   <span class="number">0</span>*km&#125;</span><br><span class="line">create vertex  &#123; <span class="number">300</span>*km&#125;  &#123;-<span class="number">300</span>*km&#125; &#123;   <span class="number">0</span>*km&#125;</span><br><span class="line">create vertex  &#123;-<span class="number">300</span>*km&#125;  &#123;-<span class="number">300</span>*km&#125; &#123;   <span class="number">0</span>*km&#125;</span><br><span class="line">create vertex  &#123;-<span class="number">300</span>*km&#125;  &#123; <span class="number">300</span>*km&#125; &#123;   <span class="number">0</span>*km&#125;</span><br><span class="line">create vertex  &#123; <span class="number">300</span>*km&#125;  &#123; <span class="number">300</span>*km&#125; &#123;-<span class="number">400</span>*km&#125;</span><br><span class="line">create vertex  &#123; <span class="number">300</span>*km&#125;  &#123;-<span class="number">300</span>*km&#125; &#123;-<span class="number">400</span>*km&#125;</span><br><span class="line">create vertex  &#123;-<span class="number">300</span>*km&#125;  &#123;-<span class="number">300</span>*km&#125; &#123;-<span class="number">400</span>*km&#125;</span><br><span class="line">create vertex  &#123;-<span class="number">300</span>*km&#125;  &#123; <span class="number">300</span>*km&#125; &#123;-<span class="number">400</span>*km&#125;</span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create curve</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 8 corner points connected to 12 side lines </span></span><br><span class="line"><span class="comment"># top 4 lines</span></span><br><span class="line">create curve vertex <span class="number">1</span> <span class="number">2</span>  </span><br><span class="line">create curve vertex <span class="number">2</span> <span class="number">3</span>  </span><br><span class="line">create curve vertex <span class="number">3</span> <span class="number">4</span></span><br><span class="line">create curve vertex <span class="number">4</span> <span class="number">1</span> </span><br><span class="line"><span class="comment"># four bottom lines</span></span><br><span class="line">create curve vertex <span class="number">5</span> <span class="number">6</span>  </span><br><span class="line">create curve vertex <span class="number">6</span> <span class="number">7</span>  </span><br><span class="line">create curve vertex <span class="number">7</span> <span class="number">8</span></span><br><span class="line">create curve vertex <span class="number">8</span> <span class="number">5</span> </span><br><span class="line"><span class="comment"># four side lines (note that the id number of the element in the process of creating a new geometry may also change, so we can give names to important elements.)</span></span><br><span class="line">create curve vertex <span class="number">1</span> <span class="number">5</span> </span><br><span class="line">create curve vertex <span class="number">6</span> <span class="number">9</span> </span><br><span class="line">create curve vertex <span class="number">7</span> <span class="number">10</span> </span><br><span class="line">create curve vertex <span class="number">11</span> <span class="number">15</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create surface</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># 12 lines connected to 6 surfaces</span></span><br><span class="line"><span class="comment"># Top surface</span></span><br><span class="line">create surface curve <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>  </span><br><span class="line"><span class="comment"># Bottom surface</span></span><br><span class="line">create surface curve <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span></span><br><span class="line"><span class="comment"># Side surfaces</span></span><br><span class="line">create surface curve <span class="number">1</span> <span class="number">5</span> <span class="number">9</span> <span class="number">10</span></span><br><span class="line">create surface curve <span class="number">2</span> <span class="number">6</span> <span class="number">10</span> <span class="number">11</span></span><br><span class="line">create surface curve <span class="number">3</span> <span class="number">7</span> <span class="number">11</span> <span class="number">12</span></span><br><span class="line">create surface curve <span class="number">4</span> <span class="number">8</span> <span class="number">9</span> <span class="number">12</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create volume</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create the volume </span></span><br><span class="line">create volume surface <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>

<div align=center>
<img src="https://i.loli.net/2019/07/13/5d29e05e1e5af88039.png
" width="60%" height="60%">
</div>

<p>The results of the above two ways are exactly the same. For more complicated examples, you can choose your own way according to the situation. Note that if you use the second method to establish the geometry, the id number of most elements will change for the left part of this manual. </p>
<h3 id="2-2-Split-the-cuboid-into-two-parts"><a href="#2-2-Split-the-cuboid-into-two-parts" class="headerlink" title="2.2. Split the cuboid into two parts"></a>2.2. Split the cuboid into two parts</h3><p>Here we create a plane to divide the cuboid into a upper part as the elastic layer and a lower part as the viscoelastic layer. And a fault plane will be created for simulation.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create interface surfaces</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">create vertex <span class="number">0</span> -<span class="number">300000</span> <span class="number">0</span></span><br><span class="line">create vertex <span class="number">0</span> <span class="number">300000</span> <span class="number">0</span></span><br><span class="line">create vertex -<span class="number">200000</span>  <span class="number">0</span> -<span class="number">400000</span></span><br><span class="line">create planar surface <span class="keyword">with</span> plane vertex <span class="number">9</span> <span class="number">10</span> <span class="number">11</span>   </span><br><span class="line">surface <span class="number">7</span> name <span class="string">&quot;fault_surface&quot;</span></span><br><span class="line">delete vertex <span class="number">9</span> <span class="number">10</span> <span class="number">11</span></span><br><span class="line">create planar surface <span class="keyword">with</span> plane zplane offset -<span class="number">20000</span></span><br><span class="line">surface <span class="number">8</span> name <span class="string">&quot;material_interface&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Divide volumes using interface surfaces</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">webcut volume <span class="number">1</span> <span class="keyword">with</span> plane surface fault_surface</span><br><span class="line">webcut volume <span class="number">1</span> <span class="keyword">with</span> plane surface material_interface</span><br><span class="line">webcut volume <span class="number">4</span> <span class="keyword">with</span> plane surface material_interface</span><br><span class="line">volume <span class="number">1</span> name <span class="string">&quot;elastic_xpos&quot;</span></span><br><span class="line">volume <span class="number">4</span> name <span class="string">&quot;elastic_xneg&quot;</span></span><br><span class="line">volume <span class="number">5</span> name <span class="string">&quot;visco_xpos&quot;</span></span><br><span class="line">volume <span class="number">6</span> name <span class="string">&quot;visco_xneg&quot;</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># create fault_plane</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">create planar surface <span class="keyword">with</span> plane yplane offset -<span class="number">20000</span> </span><br><span class="line">create planar surface <span class="keyword">with</span> plane yplane offset <span class="number">20000</span> </span><br><span class="line">split surface <span class="number">22</span> <span class="keyword">with</span> surface <span class="number">39</span></span><br><span class="line">split surface <span class="number">42</span> <span class="keyword">with</span> surface <span class="number">40</span></span><br><span class="line">surface <span class="number">43</span> name <span class="string">&quot;fault_plane&quot;</span></span><br><span class="line">delete body <span class="number">2</span> <span class="number">3</span> <span class="number">7</span> <span class="number">8</span></span><br></pre></td></tr></table></figure>
<div align=center>
<img src="https://i.loli.net/2019/07/13/5d29e05e372ac60989.png
" width="60%" height="60%">
</div>

<p>A more detailed segmentation process can be found in the <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=_5N7iZOoYtw">official tutorial</a> . (A proper vpn tool is required)</p>
<h3 id="2-3-imprint-amp-merge"><a href="#2-3-imprint-amp-merge" class="headerlink" title="2.3. imprint &amp; merge"></a>2.3. imprint &amp; merge</h3><p>After creating the split the volume, the points and lines of each sub volumes are probably not the same, so they need to be merged, which takes a certain amount of time under complex geometry.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Imprint all volumes, merging surfaces</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">imprint <span class="built_in">all</span> <span class="keyword">with</span> volume <span class="built_in">all</span></span><br><span class="line">merge <span class="built_in">all</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Meshing"><a href="#3-Meshing" class="headerlink" title="3.Meshing"></a>3.Meshing</h2><p>We need to specify the size of each curve, surface or volume before meshing them. And the <code>map</code> meshing scheme is set by default. You can use the command panal or type <code>help volume scheme</code> in the command line to view all the possible meshing schemes. The tetmesh scheme is applied in this example.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">volume <span class="built_in">all</span> scheme tetmesh </span><br><span class="line">curve <span class="built_in">all</span> scheme default</span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Set discretization size</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">surface <span class="number">43</span> size <span class="number">1000</span></span><br><span class="line">volume <span class="built_in">all</span> size <span class="number">100000</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Generate the mesh</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">volume <span class="built_in">all</span> scheme tetmesh proximity layers off geometric sizing on</span><br><span class="line">mesh volume <span class="built_in">all</span></span><br></pre></td></tr></table></figure>
<div align=center>
<img src="https://i.loli.net/2019/07/13/5d29e05e528a974620.png
" width="60%" height="60%">
</div>

<p>Now the mesh part has completed, and we recommend you to do mesh QA. You can use the command panal or type</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quality volume <span class="built_in">all</span> shape <span class="keyword">global</span> draw mesh</span><br></pre></td></tr></table></figure>
<p>in the command line to do mesh QA.Generally the minimum value should be greater than 0.2 for a reliable Pylith calculation.</p>
<p>The mesh quality of this example is as follows</p>
<div align=center>
<img src="https://i.loli.net/2019/07/13/5d29e05e65e8c71640.png
" width="60%" height="60%">
</div>

<h2 id="4-Declare-each-block-and-the-boundary-surfaces"><a href="#4-Declare-each-block-and-the-boundary-surfaces" class="headerlink" title="4.Declare each block and the boundary surfaces"></a>4.Declare each block and the boundary surfaces</h2><p>Then we need to declare each block and the bounding surfaces for calculations and determining the boundary conditions of Pylith.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create blocks for materials</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">block <span class="number">1</span> volume <span class="number">1</span> <span class="number">4</span></span><br><span class="line">block <span class="number">1</span> name <span class="string">&quot;elastic&quot;</span></span><br><span class="line">block <span class="number">2</span> volume <span class="number">5</span> <span class="number">6</span></span><br><span class="line">block <span class="number">2</span> name <span class="string">&quot;viscoelastic&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create nodeset for fault</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;fault&quot;</span> add node <span class="keyword">in</span> fault_plane</span><br><span class="line">nodeset <span class="number">10</span> group fault</span><br><span class="line">nodeset <span class="number">10</span> name <span class="string">&quot;fault&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create sideset for faces in fault</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;fault_faces&quot;</span> add face <span class="keyword">in</span> fault_plane</span><br><span class="line">sideset <span class="number">10</span> group fault_faces</span><br><span class="line">sideset <span class="number">10</span> name <span class="string">&quot;fault_faces&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create nodeset for -x face</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;face_xpos&quot;</span> add node <span class="keyword">in</span> surface <span class="number">20</span></span><br><span class="line">group <span class="string">&quot;face_xpos&quot;</span> add node <span class="keyword">in</span> surface <span class="number">28</span></span><br><span class="line">nodeset <span class="number">11</span> group face_xpos</span><br><span class="line">nodeset <span class="number">11</span> name <span class="string">&quot;face_xpos&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create nodeset for +x face</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;face_xneg&quot;</span> add node <span class="keyword">in</span> surface <span class="number">30</span></span><br><span class="line">group <span class="string">&quot;face_xneg&quot;</span> add node <span class="keyword">in</span> surface <span class="number">38</span></span><br><span class="line">nodeset <span class="number">12</span> group face_xneg</span><br><span class="line">nodeset <span class="number">12</span> name <span class="string">&quot;face_xneg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create nodeset for +y face</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;face_ypos&quot;</span> add node <span class="keyword">in</span> surface <span class="number">21</span></span><br><span class="line">group <span class="string">&quot;face_ypos&quot;</span> add node <span class="keyword">in</span> surface <span class="number">27</span></span><br><span class="line">group <span class="string">&quot;face_ypos&quot;</span> add node <span class="keyword">in</span> surface <span class="number">33</span></span><br><span class="line">group <span class="string">&quot;face_ypos&quot;</span> add node <span class="keyword">in</span> surface <span class="number">35</span></span><br><span class="line">nodeset <span class="number">13</span> group face_ypos</span><br><span class="line">nodeset <span class="number">13</span> name <span class="string">&quot;face_ypos&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create nodeset for -y face</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;face_yneg&quot;</span> add node <span class="keyword">in</span> surface <span class="number">23</span></span><br><span class="line">group <span class="string">&quot;face_yneg&quot;</span> add node <span class="keyword">in</span> surface <span class="number">25</span></span><br><span class="line">group <span class="string">&quot;face_yneg&quot;</span> add node <span class="keyword">in</span> surface <span class="number">31</span></span><br><span class="line">group <span class="string">&quot;face_yneg&quot;</span> add node <span class="keyword">in</span> surface <span class="number">37</span></span><br><span class="line">nodeset <span class="number">14</span> group face_yneg</span><br><span class="line">nodeset <span class="number">14</span> name <span class="string">&quot;face_yneg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create nodeset for -z face</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;face_zneg&quot;</span> add node <span class="keyword">in</span> surface <span class="number">12</span></span><br><span class="line">group <span class="string">&quot;face_zneg&quot;</span> add node <span class="keyword">in</span> surface <span class="number">16</span></span><br><span class="line">nodeset <span class="number">15</span> group face_zneg</span><br><span class="line">nodeset <span class="number">15</span> name <span class="string">&quot;face_zneg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create nodeset for -z face w/o fault</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;face_zneg_nofault&quot;</span> add node <span class="keyword">in</span> face_zneg</span><br><span class="line">group <span class="string">&quot;face_zneg_nofault&quot;</span> remove node <span class="keyword">in</span> fault</span><br><span class="line">nodeset <span class="number">16</span> group face_zneg_nofault</span><br><span class="line">nodeset <span class="number">16</span> name <span class="string">&quot;face_zneg_nofault&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Create nodeset for +z face</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">group <span class="string">&quot;face_zpos&quot;</span> add node <span class="keyword">in</span> surface <span class="number">10</span></span><br><span class="line">group <span class="string">&quot;face_zpos&quot;</span> add node <span class="keyword">in</span> surface <span class="number">17</span></span><br><span class="line">nodeset <span class="number">17</span> group face_zpos</span><br><span class="line">nodeset <span class="number">17</span> name <span class="string">&quot;face_zpos&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-Export-the-mesh-file"><a href="#5-Export-the-mesh-file" class="headerlink" title="5. Export the mesh file"></a>5. Export the mesh file</h2><p>At this point, we only need to exported the mesh file in exo format.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Export exodus file</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------------------------</span></span><br><span class="line">export mesh <span class="string">&quot;mesh_1km.exo&quot;</span> dimension <span class="number">3</span> overwrite</span><br></pre></td></tr></table></figure>
<p>From the output of the Command Line you can see how many elements and nodes you have in the generated mesh file. Generally speaking, the more nodes, the longer the calculation time.</p>
<div align=center>
<img src="https://i.loli.net/2019/07/13/5d29e05e51fae26755.png
" width="70%" height="70%">
</div>

<hr>
<p>Reference<br>[1] Aagaard, B.T., Kientz, S., Knepley, M.G., Strand, L., Williams, C., 2017. PyLith User Manual: version 2.2.1. Davis: California: Computational Infrastructure of Geodynamics<br>[2] <a target="_blank" rel="noopener" href="https://www.csimsoft.com/tutorialsTrelis#step">Tutorial of Trelis</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Pylith/" rel="tag"># Pylith</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/25111.html" rel="next" title="「Pylith」Simple tutorial (I) Installing softwares">
                <i class="fa fa-chevron-left"></i> 「Pylith」Simple tutorial (I) Installing softwares
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/61483.html" rel="prev" title="「Pylith」Simple tutorial (III) Model simulation">
                「Pylith」Simple tutorial (III) Model simulation <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://i.loli.net/2017/08/24/599ea0e05f155.jpg"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Trelis-interface"><span class="nav-number">1.</span> <span class="nav-text">1.Trelis interface</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Create-Geometry"><span class="nav-number">2.</span> <span class="nav-text">2.Create Geometry</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Create-a-volume"><span class="nav-number">2.1.</span> <span class="nav-text">2.1. Create a volume</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Split-the-cuboid-into-two-parts"><span class="nav-number">2.2.</span> <span class="nav-text">2.2. Split the cuboid into two parts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-imprint-amp-merge"><span class="nav-number">2.3.</span> <span class="nav-text">2.3. imprint &amp; merge</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Meshing"><span class="nav-number">3.</span> <span class="nav-text">3.Meshing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Declare-each-block-and-the-boundary-surfaces"><span class="nav-number">4.</span> <span class="nav-text">4.Declare each block and the boundary surfaces</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Export-the-mesh-file"><span class="nav-number">5.</span> <span class="nav-text">5. Export the mesh file</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">collyking</span>

  
  <div class="powered-by">
  </div>
  <span>Hosted by <a target="_blank" rel="noopener" href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a></div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://collyking.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://collyking.top/2020/24164.html';
          this.page.identifier = '2020/24164.html';
          this.page.title = '「Pylith」Simple tutorial (II) Model set up';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://collyking.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  










  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("bkpkIr9LF8yXdIwgSbybzFo8-gzGzoHsz", "BT3VkhllMRRtaOuOzzjbCNOL");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
